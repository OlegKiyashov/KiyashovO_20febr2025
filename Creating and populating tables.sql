-- Создание таблицы категорий продуктов
CREATE TABLE Categories (
    category_id SERIAL PRIMARY KEY,  -- Уникальный идентификатор категории, автоинкремент
    category_name VARCHAR(255) NOT NULL UNIQUE -- Название категории (уникальное)
);

-- Создание таблицы продуктов
CREATE TABLE Products (
    product_id SERIAL PRIMARY KEY,   -- Уникальный идентификатор продукта
    product_name VARCHAR(255) NOT NULL, -- Название продукта
    category_id INT NOT NULL,        -- Внешний ключ, ссылающийся на категорию
    calories INT,                    -- Калорийность продукта (в ккал)
    price DECIMAL(10, 2),            -- Цена продукта с двумя знаками после запятой (например, 150.00)
    CONSTRAINT fk_category FOREIGN KEY (category_id) REFERENCES Categories(category_id) 
    ON DELETE CASCADE                -- Если категорию удалят, удалятся и связанные продукты
);

-- Создание таблицы пищевой ценности
CREATE TABLE NutritionalInformation (
    product_id INT PRIMARY KEY,      -- Внешний ключ на продукт (каждый продукт имеет одну запись)
    protein DECIMAL(5, 2),           -- Количество белка (в граммах)
    carbohydrates DECIMAL(5, 2),     -- Количество углеводов (в граммах)
    fat DECIMAL(5, 2),               -- Количество жиров (в граммах)
    fiber DECIMAL(5, 2),             -- Количество клетчатки (в граммах)
    CONSTRAINT fk_product FOREIGN KEY (product_id) REFERENCES Products(product_id) 
    ON DELETE CASCADE                -- Если удалить продукт, удалится и его пищевая ценность
);


-- Заполнение таблицы категорий
INSERT INTO Categories (category_name) VALUES
('Травяные чаи'),    -- ID = 1
('Травы'),           -- ID = 2
('Алтайский мёд'),   -- ID = 3
('Бальзамы и сиропы'),-- ID = 4
('Грибы'),           -- ID = 5
('Кедровые орехи'),  -- ID = 6
('Сладости');        -- ID = 7

-- Заполнение таблицы продуктов
INSERT INTO Products (product_name, category_id, calories, price) VALUES
-- Категория "Травяные чаи" (category_id = 1)
('Травяной чай "Сибирский сбор"', 1, 5, 150.00),
('Травяной чай "Горный Алтай"', 1, 4, 170.00),
('Травяной чай "Таёжный аромат"', 1, 6, 160.00),

-- Категория "Травы" (category_id = 2)
('Ромашка аптечная (трава)', 2, 1, 50.00),
('Зверобой продырявленный (трава)', 2, 2, 60.00),
('Чабрец (трава)', 2, 1, 55.00),

-- Категория "Алтайский мёд" (category_id = 3)
('Алтайский мёд с мумие', 3, 328, 500.00),
('Алтайский мёд с прополисом', 3, 330, 520.00),
('Алтайский мёд с маточным молочком', 3, 332, 540.00),

-- Категория "Бальзамы и сиропы" (category_id = 4)
('Бальзам "Алтайский букет"', 4, 250, 300.00),
('Сироп шиповника', 4, 280, 200.00),
('Бальзам "Горный"', 4, 260, 320.00),

-- Категория "Грибы" (category_id = 5)
('Чага (гриб)', 5, 15, 400.00),
('Рейши (гриб)', 5, 20, 450.00),
('Веселка (гриб)', 5, 18, 420.00),

-- Категория "Кедровые орехи" (category_id = 6)
('Кедровые орехи очищенные', 6, 673, 800.00),
('Кедровые орехи в скорлупе', 6, 670, 750.00),
('Кедровое масло', 6, 900, 1000.00),

-- Категория "Сладости" (category_id = 7)
('Мёд-суфле с черникой', 7, 340, 350.00),
('Мёд-суфле с малиной', 7, 345, 360.00),
('Мёд-суфле с облепихой', 7, 335, 355.00),
('Коктейль льняной', 7, 268, 210.00),
('Семена чиа', 7, 486, 300.00);


-- Заполнение таблицы пищевой ценности
INSERT INTO NutritionalInformation (product_id, protein, carbohydrates, fat, fiber) VALUES
-- Травяные чаи
(1, 0.5, 1.0, 0.1, 0.2),
(2, 0.4, 0.8, 0.1, 0.1),
(3, 0.6, 1.2, 0.1, 0.3),

-- Травы
(4, 0.1, 0.2, 0.0, 0.1),
(5, 0.2, 0.3, 0.0, 0.1),
(6, 0.1, 0.2, 0.0, 0.1),

-- Алтайский мёд
(7, 0.3, 82.0, 0.0, 0.0),
(8, 0.3, 83.0, 0.0, 0.0),
(9, 0.4, 84.0, 0.0, 0.0),

-- Бальзамы и сиропы
(10, 0.2, 65.0, 0.0, 0.0),
(11, 0.1, 70.0, 0.0, 0.0),
(12, 0.3, 68.0, 0.0, 0.0),

-- Грибы
(13, 1.0, 1.5, 0.1, 0.5),
(14, 1.2, 1.8, 0.1, 0.6),
(15, 1.1, 1.6, 0.1, 0.5),

-- Кедровые орехи
(16, 13.7, 13.1, 68.4, 3.7),
(17, 13.0, 14.0, 67.0, 3.5),
(18, 0.0, 0.0, 100.0, 0.0),

-- Сладости
(19, 0.5, 80.0, 0.0, 0.0),
(20, 0.6, 81.0, 0.0, 0.0),
(21, 0.4, 79.0, 0.0, 0.0),
(22, 30.4, 16.0, 8.4, 26.8),  -- Коктейль льняной
(23, 42.0, 31.0, 16.5, 27.3); -- Семена чиа

--  Проверка категорий
SELECT * FROM Categories;

--  Проверка продуктов с категориями
SELECT p.product_id, p.product_name, c.category_name, p.calories, p.price
FROM Products p
JOIN Categories c ON p.category_id = c.category_id;

--  Проверка пищевой ценности
SELECT p.product_name, n.protein, n.carbohydrates, n.fat, n.fiber
FROM NutritionalInformation n
JOIN Products p ON n.product_id = p.product_id;
